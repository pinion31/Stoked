{"version":3,"sources":["../../server/routes/user.js"],"names":["express","require","router","Router","User","post","req","res","findOneAndUpdate","profileId","body","name","description","profilePic","data","fs","readFileSync","photo","contentType","new","then","status","json","user","catch","err","console","log","session","passport","findOne","save","toObject","error","get","find","lean","users","module","exports"],"mappings":"AAAA;;AAEA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,SAASF,QAAQG,MAAR,EAAf;AACA,IAAMC,OAAOH,QAAQ,gBAAR,CAAb;;AAEA;;;;AAIAC,OAAOG,IAAP,CAAY,UAAZ,EAAwB,UAACC,GAAD,EAAKC,GAAL,EAAa;AACnCH,OAAKI,gBAAL,CAAsB,EAACC,WAAWH,IAAII,IAAJ,CAASD,SAArB,EAAtB,EAAuD;AACrDE,UAAML,IAAII,IAAJ,CAASC,IADsC;AAErDC,iBAAaN,IAAII,IAAJ,CAASE,WAF+B;AAGrDC,gBAAY;AACVC,YAAMC,GAAGC,YAAH,CAAgBV,IAAII,IAAJ,CAASO,KAAzB,CADI;AAEVC,mBAAa;AAFH;AAHyC,GAAvD,EAQA;AACEC,SAAI;AADN,GARA,EAUGC,IAVH,CAUQ,gBAAQ;AACdb,QAAIc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBC,IAArB;AACD,GAZD,EAYGC,KAZH,CAYS,eAAO;AACd,UAAMC,GAAN;AACD,GAdD;;AAgBA;;;;;;;;;;;AAaD,CA9BD;;AAgCA;;;;AAIAvB,OAAOG,IAAP,CAAY,WAAZ,EAAyB,UAACC,GAAD,EAAKC,GAAL,EAAa;AACpCmB,UAAQC,GAAR,CAAYrB,IAAIsB,OAAJ,CAAYC,QAAZ,CAAqBN,IAArB,CAA0Bd,SAAtC;AACAL,OAAK0B,OAAL,CAAa,EAACrB,WAAWH,IAAIsB,OAAJ,CAAYC,QAAZ,CAAqBN,IAArB,CAA0Bd,SAAtC,EAAb,EACGW,IADH,CACQ,gBAAQ;AACZ,QAAIG,IAAJ,EAAU;AACRA,WAAKZ,IAAL,GAAYL,IAAII,IAAJ,CAASC,IAArB;AACAY,WAAKX,WAAL,GAAmBN,IAAII,IAAJ,CAASE,WAA5B;AACAW,WAAKV,UAAL,GAAkBP,IAAII,IAAJ,CAASG,UAA3B;AACAU,WAAKQ,IAAL;AACAxB,UAAIc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBC,KAAKS,QAAL,EAArB;AACD,KAND,MAMO;AACLzB,UAAIc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACW,OAAO,gBAAR,EAArB;AACD;AACF,GAXH;AAYD,CAdD;;AAgBA/B,OAAOgC,GAAP,CAAW,UAAX,EAAuB,UAAC5B,GAAD,EAAKC,GAAL,EAAa;AAClCH,OAAK+B,IAAL,CAAU,EAAC1B,WAAWH,IAAIsB,OAAJ,CAAYC,QAAZ,CAAqBN,IAArB,CAA0Bd,SAAtC,EAAV,EAA4D2B,IAA5D,GACGhB,IADH,CACQ,gBAAQ;AACZb,QAAIc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBC,KAAK,CAAL,CAArB;AACD,GAHH,EAGKC,KAHL,CAGW,eAAO;AACd,QAAIC,GAAJ,EAAS;AACP,YAAMA,GAAN;AACD;AACF,GAPH;AAQD,CATD;;AAWAvB,OAAOgC,GAAP,CAAW,cAAX,EAA2B,UAAC5B,GAAD,EAAKC,GAAL,EAAa;AACtCH,OAAK+B,IAAL,CAAU,EAAV,EAAcC,IAAd,GACGhB,IADH,CACQ,iBAAS;AACbb,QAAIc,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,CAACe,KAAD,CAArB;AACD,GAHH,EAGKb,KAHL,CAGW,eAAO;AACd,QAAIC,GAAJ,EAAS;AACP,YAAMA,GAAN;AACD;AACF,GAPH;AAQD,CATD;;AAWAa,OAAOC,OAAP,GAAiBrC,MAAjB","file":"user.js","sourcesContent":["'use strict';\r\n\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst User = require('../models/user');\r\n\r\n/**\r\n* req input: {name:String, email: String, profilePic: String, description:String}\r\n* res output: {_id: String, name:String, email: String, profilePic: String, description:String, __v: Number}\r\n*/\r\nrouter.post('/addUser', (req,res) => {\r\n  User.findOneAndUpdate({profileId: req.body.profileId}, {\r\n    name: req.body.name,\r\n    description: req.body.description,\r\n    profilePic: {\r\n      data: fs.readFileSync(req.body.photo),\r\n      contentType: 'image/jpg'\r\n    },\r\n  },\r\n  {\r\n    new:true\r\n  }).then(user => {\r\n    res.status(200).json(user);\r\n  }).catch(err => {\r\n    throw err;\r\n  });\r\n\r\n  /*const user = new User({\r\n    profileId: req.body.email,\r\n    name: req.body.name,\r\n    description: req.body.description,\r\n    profilePic: req.body.profilePic,\r\n  });\r\n\r\n  user.save((err) => {\r\n    if (err) {throw err; }\r\n    const newUser = user.toObject();\r\n\r\n    res.json(newUser);\r\n  });*/\r\n});\r\n\r\n/**\r\n* req input: {name:String, profilePic: String, description:String}\r\n* res output: {_id: String, name:String, profileId: String, profilePic: String, description:String, __v: Number}\r\n*/\r\nrouter.post('/editUser', (req,res) => {\r\n  console.log(req.session.passport.user.profileId);\r\n  User.findOne({profileId: req.session.passport.user.profileId})\r\n    .then(user => {\r\n      if (user) {\r\n        user.name = req.body.name;\r\n        user.description = req.body.description;\r\n        user.profilePic = req.body.profilePic;\r\n        user.save();\r\n        res.status(200).json(user.toObject());\r\n      } else {\r\n        res.status(500).json({error: 'user not found'});\r\n      }\r\n    });\r\n});\r\n\r\nrouter.get('/getUser', (req,res) => {\r\n  User.find({profileId: req.session.passport.user.profileId}).lean()\r\n    .then(user => {\r\n      res.status(200).json(user[0]);\r\n    }).catch(err => {\r\n      if (err) {\r\n        throw err;\r\n      }\r\n    });\r\n});\r\n\r\nrouter.get('/getAllUsers', (req,res) => {\r\n  User.find({}).lean()\r\n    .then(users => {\r\n      res.status(200).json([users]);\r\n    }).catch(err => {\r\n      if (err) {\r\n        throw err;\r\n      }\r\n    });\r\n});\r\n\r\nmodule.exports = router;\r\n"]}