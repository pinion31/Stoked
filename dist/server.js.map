{"version":3,"sources":["../server/server.js"],"names":["express","require","mongoose","fs","multer","path","app","user","friends","session","cookieParser","passport","TwitterStrategy","Strategy","User","connect","Promise","global","bodyParser","db","connection","use","secret","process","env","SESSION_SECRET","cookie","secure","resave","saveUninitialized","initialize","json","urlencoded","extended","static","join","__dirname","redirect","newUserId","consumerKey","CLIENT_KEY_TWITTER_STOKED","consumerSecret","CLIENT_SECRET_TWITTER_STOKED","callbackURL","token","tokenSecret","profile","done","findOne","profileId","id","exec","err","toString","console","log","newUser","name","description","profilePic","save","data","serializeUser","deserializeUser","obj","get","authenticate","failureRedirect","req","res","url","sendFile","resolve","listen","PORT","module","exports"],"mappings":"AAAA;;AAEA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,WAAWD,QAAQ,UAAR,CAAjB;AACA,IAAME,KAAKF,QAAQ,IAAR,CAAX;AACA,IAAMG,SAASH,QAAQ,QAAR,CAAf;AACA,IAAMI,OAAOJ,QAAQ,MAAR,CAAb;AACA,IAAMK,MAAMN,SAAZ;AACA,IAAMO,OAAON,QAAQ,eAAR,CAAb;AACA,IAAMO,UAAUP,QAAQ,kBAAR,CAAhB;AACA,IAAMQ,UAAUR,QAAQ,iBAAR,CAAhB;AACA,IAAMS,eAAeT,QAAQ,eAAR,CAArB;;AAEA,IAAMU,WAAWV,QAAQ,UAAR,CAAjB;AACA,IAAMW,kBAAkBX,QAAQ,kBAAR,EAA4BY,QAApD;;AAGA,IAAMC,OAAOb,QAAQ,eAAR,CAAb;;AAEAC,SAASa,OAAT,CAAiB,2BAAjB;AACAb,SAASc,OAAT,GAAmBC,OAAOD,OAA1B;;AAEA,IAAME,aAAajB,QAAQ,aAAR,CAAnB;;AAEA,IAAMkB,KAAKjB,SAASkB,UAApB;;AAEAd,IAAIe,GAAJ,CAAQX,cAAR;AACAJ,IAAIe,GAAJ,CAAQZ,QAAQ,EAACa,QAAQC,QAAQC,GAAR,CAAYC,cAArB,EAAqCC,QAAQ,EAACC,QAAQ,KAAT,EAA7C,EAA8DC,QAAQ,IAAtE,EAA4EC,mBAAmB,IAA/F,EAAR,CAAR;AACAvB,IAAIe,GAAJ,CAAQV,SAASmB,UAAT,EAAR;AACAxB,IAAIe,GAAJ,CAAQV,SAASF,OAAT,EAAR;AACAH,IAAIe,GAAJ,CAAQH,WAAWa,IAAX,EAAR;AACAzB,IAAIe,GAAJ,CAAQH,WAAWc,UAAX,CAAsB,EAAEC,UAAU,KAAZ,EAAtB,CAAR;AACA3B,IAAIe,GAAJ,CAAQrB,QAAQkC,MAAR,CAAe7B,KAAK8B,IAAL,CAAUC,SAAV,EAAqB,WAArB,CAAf,CAAR;;AAEA9B,IAAIe,GAAJ,CAAQ,OAAR,EAAiBd,IAAjB;;AAEA,IAAI8B,WAAW,YAAf;AACA,IAAIC,YAAY,EAAhB;;AAEA3B,SAASU,GAAT,CAAa,IAAIT,eAAJ,CAAoB;AAC/B2B,eAAahB,QAAQC,GAAR,CAAYgB,yBADM;AAE/BC,kBAAgBlB,QAAQC,GAAR,CAAYkB,4BAFG;AAG/BC,eAAa;AAHkB,CAApB,EAKb,UAACC,KAAD,EAAQC,WAAR,EAAqBC,OAArB,EAA8BC,IAA9B,EAAuC;AACrCjC,OAAKkC,OAAL,CAAa,EAACC,WAAWH,QAAQI,EAApB,EAAb,EACGC,IADH,CACQ,UAACC,GAAD,EAAM7C,IAAN,EAAe;AACrB+B,gBAAYQ,QAAQI,EAAR,CAAWG,QAAX,EAAZ;AACAC,YAAQC,GAAR,CAAY,OAAZ,EAAqBX,KAArB;AACA,QAAIrC,SAAS,IAAb,EAAmB;AACf8B,iBAAW,YAAX;;AAEA,aAAOU,KAAK,IAAL,EAAWxC,IAAX,CAAP;AACD;;AAED8B,eAAW,SAAX;;AAEA,QAAMmB,UAAU,IAAI1C,IAAJ,CAAS;AACvBmC,iBAAWH,QAAQI,EADI;AAEvBO,YAAM,EAFiB;AAGvBC,mBAAa,EAHU;AAIvBC,kBAAY;AAJW,KAAT,CAAhB;;AAOAH,YAAQI,IAAR,CAAa,UAACR,GAAD,EAAMS,IAAN,EAAe;AAC1B,UAAIT,GAAJ,EAAS;AACP,eAAOL,KAAKK,GAAL,CAAP;AACD;AACD,aAAOL,KAAK,IAAL,EAAWc,IAAX,CAAP;AACD,KALD;AAMD,GAzBH;AA0BD,CAhCY,CAAb;;AAmCAlD,SAASmD,aAAT,CAAuB,UAASvD,IAAT,EAAewC,IAAf,EAAqB;AAC1CA,OAAK,IAAL,EAAWxC,IAAX;AACD,CAFD;;AAIAI,SAASoD,eAAT,CAAyB,UAASC,GAAT,EAAcjB,IAAd,EAAoB;AAC3CA,OAAK,IAAL,EAAWiB,GAAX;AACD,CAFD;;AAIA1D,IAAI2D,GAAJ,CAAQ,eAAR,EAAyBtD,SAASuD,YAAT,CAAsB,SAAtB,CAAzB;;AAEA5D,IAAI2D,GAAJ,CAAQ,wBAAR,EACEtD,SAASuD,YAAT,CAAsB,SAAtB,EAAiC,EAACC,iBAAiB,GAAlB,EAAjC,CADF,EAC4D,UAACC,GAAD,EAAMC,GAAN,EAAc;AACtE,MAAMC,MAAMjC,aAAa,SAAb,gBAAmCC,SAAnC,mBAA8DA,SAA1E;AACA+B,MAAIhC,QAAJ,CAAaiC,GAAb;AACD,CAJH;;AAOAhE,IAAI2D,GAAJ,CAAQ,GAAR,EAAa,UAASG,GAAT,EAAcC,GAAd,EAAkB;AAC7BA,MAAIE,QAAJ,CAAalE,KAAKmE,OAAL,CAAapC,SAAb,EAAwB,WAAxB,EAAqC,YAArC,CAAb;AACD,CAFD;;AAIA9B,IAAImE,MAAJ,CAAWlD,QAAQC,GAAR,CAAYkD,IAAZ,IAAoB,IAA/B,EAAqC,YAAM;AACzCpB,UAAQC,GAAR,CAAY,kCAAZ;AACD,CAFD;;AAIAoB,OAAOC,OAAP,GAAiBtE,GAAjB","file":"server.js","sourcesContent":["'use strict';\n\nconst express = require('express');\nconst mongoose = require('mongoose');\nconst fs = require('fs');\nconst multer = require('multer');\nconst path = require('path');\nconst app = express();\nconst user = require('./routes/user');\nconst friends = require('./routes/friends');\nconst session = require('express-session');\nconst cookieParser = require('cookie-parser');\n\nconst passport = require('passport');\nconst TwitterStrategy = require('passport-twitter').Strategy;\n\n\nconst User = require('./models/user');\n\nmongoose.connect('mongodb://localhost/local');\nmongoose.Promise = global.Promise;\n\nconst bodyParser = require('body-parser');\n\nconst db = mongoose.connection;\n\napp.use(cookieParser());\napp.use(session({secret: process.env.SESSION_SECRET, cookie: {secure: false}, resave: true, saveUninitialized: true}));\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(express.static(path.join(__dirname, '../static')));\n\napp.use('/user', user);\n\nvar redirect = '/Dashboard';\nvar newUserId = '';\n\npassport.use(new TwitterStrategy({\n  consumerKey: process.env.CLIENT_KEY_TWITTER_STOKED,\n  consumerSecret: process.env.CLIENT_SECRET_TWITTER_STOKED,\n  callbackURL: 'http://localhost:8080/auth/twitter/callback'\n},\n(token, tokenSecret, profile, done) => {\n  User.findOne({profileId: profile.id})\n    .exec((err, user) => {\n    newUserId = profile.id.toString();\n    console.log('token', token);\n    if (user !== null) {\n        redirect = '/Dashboard';\n\n        return done(null, user);\n      }\n\n      redirect = '/SignUp';\n\n      const newUser = new User({\n        profileId: profile.id,\n        name: '',\n        description: '',\n        profilePic: '',\n      });\n\n      newUser.save((err, data) => {\n        if (err) {\n          return done(err);\n        }\n        return done(null, data);\n      });\n    });\n}));\n\n\npassport.serializeUser(function(user, done) {\n  done(null, user);\n});\n\npassport.deserializeUser(function(obj, done) {\n  done(null, obj);\n});\n\napp.get('/auth/twitter', passport.authenticate('twitter'));\n\napp.get('/auth/twitter/callback',\n  passport.authenticate('twitter', {failureRedirect: '/'}), (req, res) => {\n    const url = redirect === '/SignUp'? `/SignUp?${newUserId}`: `/Dashboard?${newUserId}`;\n    res.redirect(url);\n  }\n);\n\napp.get('*', function(req, res){\n  res.sendFile(path.resolve(__dirname, '../static', 'index.html'));\n});\n\napp.listen(process.env.PORT || 3000, () => {\n  console.log('App started for your convenience');\n});\n\nmodule.exports = app;\n"]}