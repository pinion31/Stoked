{"version":3,"sources":["../server/server.js"],"names":["express","require","mongoose","path","app","user","friends","session","cookieParser","passport","TwitterStrategy","Strategy","User","connect","process","env","MONGOLAB_URI","Promise","global","bodyParser","use","json","limit","urlencoded","extended","db","connection","secret","SESSION_SECRET","cookie","secure","resave","saveUninitialized","initialize","static","join","__dirname","redirect","newUserId","consumerKey","CLIENT_KEY_TWITTER_STOKED","consumerSecret","CLIENT_SECRET_TWITTER_STOKED","callbackURL","token","tokenSecret","profile","done","findOne","profileId","id","exec","err","toString","newUser","name","description","profilePic","save","data","serializeUser","deserializeUser","obj","get","authenticate","failureRedirect","req","res","url","undefined","sendFile","resolve","listen","PORT","console","log","module","exports"],"mappings":"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","file":"server.js","sourcesContent":["'use strict';\n\nconst express = require('express');\nconst mongoose = require('mongoose');\nconst path = require('path');\nconst app = express();\nconst user = require('./routes/user');\nconst friends = require('./routes/friends');\nconst session = require('express-session');\nconst cookieParser = require('cookie-parser');\n\nconst passport = require('passport');\nconst TwitterStrategy = require('passport-twitter').Strategy;\n\nconst User = require('./models/user');\n\nmongoose.connect(process.env.MONGOLAB_URI);\nmongoose.Promise = global.Promise;\n\nconst bodyParser = require('body-parser');\napp.use(bodyParser.json({limit: '5mb'}));\napp.use(bodyParser.urlencoded({ extended: false, limit: '5mb' }));\nconst db = mongoose.connection;\n\napp.use(cookieParser());\napp.use(session({secret: process.env.SESSION_SECRET, cookie: {secure: false}, resave: true, saveUninitialized: true}));\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(express.static(path.join(__dirname, '../static')));\n\napp.use('/user', user);\n\nvar redirect = '/Dashboard';\nvar newUserId = '';\n\npassport.use(new TwitterStrategy({\n  consumerKey: process.env.CLIENT_KEY_TWITTER_STOKED,\n  consumerSecret: process.env.CLIENT_SECRET_TWITTER_STOKED,\n  callbackURL: 'http://localhost:8080/auth/twitter/callback'\n},\n(token, tokenSecret, profile, done) => {\n  User.findOne({profileId: profile.id})\n    .exec((err, user) => {\n    newUserId = profile.id.toString();\n    if (user !== null) {\n        redirect = '/Dashboard';\n\n        return done(null, user);\n      }\n\n      redirect = '/SignUp';\n\n      const newUser = new User({\n        profileId: profile.id,\n        name: '',\n        description: '',\n        profilePic: '',\n      });\n\n      newUser.save((err, data) => {\n        if (err) {\n          return done(err);\n        }\n        return done(null, data);\n      });\n    });\n}));\n\n\npassport.serializeUser(function(user, done) {\n  done(null, user);\n});\n\npassport.deserializeUser(function(obj, done) {\n  done(null, obj);\n});\n\napp.get('/auth/twitter', passport.authenticate('twitter'));\n\napp.get('/auth/twitter/callback',\n  passport.authenticate('twitter', {failureRedirect: '/'}), (req, res) => {\n    const url = redirect === '/SignUp'? `/SignUp?${newUserId}`: `/Dashboard?${newUserId}`;\n    res.redirect(url);\n  }\n);\n\napp.get('*', function(req, res){\n  if (req.session === undefined) {\n    return res.redirect('/');\n  }\n\n  res.sendFile(path.resolve(__dirname, '../static', 'index.html'));\n});\n\napp.listen(process.env.PORT || 3000, () => {\n  console.log('App started for your convenience');\n});\n\nmodule.exports = app;\n"]}