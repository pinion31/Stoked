{"version":3,"sources":["../server/server.js"],"names":["express","require","mongoose","fs","getRawBody","contentType","multer","upload","dest","path","app","user","friends","session","cookieParser","passport","TwitterStrategy","Strategy","User","connect","Promise","global","bodyParser","use","json","limit","urlencoded","extended","db","connection","secret","process","env","SESSION_SECRET","cookie","secure","resave","saveUninitialized","initialize","static","join","__dirname","post","single","req","res","next","redirect","newUserId","consumerKey","CLIENT_KEY_TWITTER_STOKED","consumerSecret","CLIENT_SECRET_TWITTER_STOKED","callbackURL","token","tokenSecret","profile","done","findOne","profileId","id","exec","err","toString","console","log","newUser","name","description","profilePic","save","data","serializeUser","deserializeUser","obj","get","authenticate","failureRedirect","url","sendFile","resolve","listen","PORT","module","exports"],"mappings":"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","file":"server.js","sourcesContent":["'use strict';\n\nconst express = require('express');\nconst mongoose = require('mongoose');\nconst fs = require('fs');\nconst getRawBody = require('raw-body');\nconst contentType = require('content-type')\nconst multer = require('multer');\nconst upload = multer({ dest: 'uploads/' });\nconst path = require('path');\nconst app = express();\nconst user = require('./routes/user');\nconst friends = require('./routes/friends');\nconst session = require('express-session');\nconst cookieParser = require('cookie-parser');\n\nconst passport = require('passport');\nconst TwitterStrategy = require('passport-twitter').Strategy;\n\n\nconst User = require('./models/user');\n\nmongoose.connect('mongodb://localhost/local');\nmongoose.Promise = global.Promise;\n\nconst bodyParser = require('body-parser');\napp.use(bodyParser.json({limit: '5mb'}));\napp.use(bodyParser.urlencoded({ extended: false, limit: '5mb' }));\nconst db = mongoose.connection;\n\n/*\napp.use(function (req, res, next) {\n  getRawBody(req, {\n    length: req.headers['content-length'],\n    limit: '4mb',\n    //encoding: contentType.parse(req).parameters.charset\n  }, function (err, string) {\n    if (err) return next(err)\n    console.log('string',string);\n    req.text = string;\n    next();\n  })\n});*/\n\napp.use(cookieParser());\napp.use(session({secret: process.env.SESSION_SECRET, cookie: {secure: false}, resave: true, saveUninitialized: true}));\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(express.static(path.join(__dirname, '../static')));\n\napp.use('/user', user);\n\napp.post('/profile', upload.single('avatar'), function (req, res, next) {\n  // req.file is the `avatar` file\n  // req.body will hold the text fields, if there were any\n})\n\nvar redirect = '/Dashboard';\nvar newUserId = '';\n\npassport.use(new TwitterStrategy({\n  consumerKey: process.env.CLIENT_KEY_TWITTER_STOKED,\n  consumerSecret: process.env.CLIENT_SECRET_TWITTER_STOKED,\n  callbackURL: 'http://localhost:8080/auth/twitter/callback'\n},\n(token, tokenSecret, profile, done) => {\n  User.findOne({profileId: profile.id})\n    .exec((err, user) => {\n    newUserId = profile.id.toString();\n    console.log('token', token);\n    if (user !== null) {\n        redirect = '/Dashboard';\n\n        return done(null, user);\n      }\n\n      redirect = '/SignUp';\n\n      const newUser = new User({\n        profileId: profile.id,\n        name: '',\n        description: '',\n        profilePic: '',\n      });\n\n      newUser.save((err, data) => {\n        if (err) {\n          return done(err);\n        }\n        return done(null, data);\n      });\n    });\n}));\n\n\npassport.serializeUser(function(user, done) {\n  done(null, user);\n});\n\npassport.deserializeUser(function(obj, done) {\n  done(null, obj);\n});\n\napp.get('/auth/twitter', passport.authenticate('twitter'));\n\napp.get('/auth/twitter/callback',\n  passport.authenticate('twitter', {failureRedirect: '/'}), (req, res) => {\n    const url = redirect === '/SignUp'? `/SignUp?${newUserId}`: `/Dashboard?${newUserId}`;\n    res.redirect(url);\n  }\n);\n\napp.get('*', function(req, res){\n  res.sendFile(path.resolve(__dirname, '../static', 'index.html'));\n});\n\napp.listen(process.env.PORT || 3000, () => {\n  console.log('App started for your convenience');\n});\n\nmodule.exports = app;\n"]}